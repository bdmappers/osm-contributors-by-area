$(function(){function a(a){var b="";return f.addClass("loading"),$.ajax({async:!1,url:"http://api.openstreetmap.org/api/0.6/user/"+a,dataType:"xml",success:function(a){b=$(a).find("img").attr("href"),f.removeClass("loading")}}),b}var b=15,c=new L.Map("map",{attribution:'<a href="http://leafletjs.com/">Leaflet</a> &bull; <a href="http://osm.org/" target="_blank">OpenStreetMap contributors</a>',layers:L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),minZoom:b}),d="http://overpass-api.de/api/interpreter?";c.setView(L.latLng(42.4461,12.4937),b);var e=(L.geoJson([]).addTo(c),{}),f=$("#sidebar"),g=$("#userlist");window.users=e,L.layerJSON({minZoom:15,url:d+'data=[out:json];way["highway"~"."]({lat1},{lon1},{lat2},{lon2});>;out meta;',propertyItems:"elements",propertyTitle:"tags.name",propertyLoc:["lat","lon"],dataToMarker:function(b,c){return e[b.uid]?e[b.uid].locs.push(c):(e[b.uid]={username:b.user,avatar:a(b.uid),color:rgb2hex(randcolor()),locs:[c]},g.append('<div class="useritem" style="background:'+e[b.uid].color+'"><img height="24" width="25" src="'+e[b.uid].avatar+'" /> <a target="_blank" href="http://osm.org/user/'+e[b.uid].username+'">'+e[b.uid].username+"</a></div>")),!1}}).on("dataloading",function(){console.log("dataloading"),g.empty()}).on("dataloaded",function(){for(var a in e)var b=L.rectangle(L.latLngBounds(e[a].locs),{color:e[a].color}).addTo(c)}).addTo(c),L.control.sidebar("sidebar",{position:"right"}).addTo(c).show()});